#!/bin/bash


#################################################################
#                        Music_Finder V1.1                      #
#  https://gitlab.com/hessam.ashari/Search_Music_and_Playe.git  #
#################################################################


clear

GRE='\033[92m' # Green Light
RD='\033[91m' # Red Light

# ----------\Main function\----------
function main(){
	echo "-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/"
	echo "Please Select your path "

	read -p "Do you like to serach all in of system (Requires root access)? [Y/n] " all_system

	if [[ "$all_system" == "" || "$all_system" == "y" || "$all_system" == "Y" ]]; then
		# ----------\Search all of file system\----------
	    echo "-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/"
	    echo "This operation may take a while!"

	    read -p "Please enter the name of music wich you search : " name
	    read -p "Please Select your type d {directory} f {file} : " typelike

	    if [[ $typelike == "d" ]]; then
	        sudo find  / -type d -name  $name
	    elif [[ $typelike == "f" ]]; then
	        echo "Install the mplayer if you want tp play music after find it"
	        sudo find / -type f -name "*$name*" -exec mplayer {} \;
	    else
	        echo -e "${RD}Your type is not true!"
	    fi
	elif [[ "$all_system" == "n" || "$all_system" == "N" ]]; then
		read -p "Do you like search this directory? [Y/n] " likedirectory

		if [[ "$likedirectory" == "" || "$likedirectory" == "y" || "$likedirectory" == "Y" ]]; then
			# ----------\Search current directory\----------
		    echo "-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/"

		    read -p "Please enter the name of music wich you search : " name
		    read -p "Please Select your type d {directory} f {file} : " typelike

		    if [[ $typelike == "d" ]]; then
		        find  $PWD -type d -name  $name
		    elif [[ $typelike == "f" ]]; then
		        echo "Install the mplayer if you want tp play music after find it"
		        find  $PWD -type f -name "*$name*" -exec mplayer {} \;
		    else
		        echo -e "${RD}Your type is not true!"
		    fi
		elif [[ "$likedirectory" == "n" || "$likedirectory" == "N" ]]; then
			# ----------\Search entered path\----------
			read -p "Enter a directory : " -i "" -e addressdirectory 
		    echo "-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/"

		    read -p "Please enter the name of music wich you search : " name
		    read -p "Please Select your type d {directory} f {file} : " liketype

		    if [[ $liketype == "d" ]]; then
		        find $addressdirectory -type d -iname $name
		    elif [[ $liketype == "f" ]]; then
		        echo "Install the mplayer if you want tp play music after find it"
		        find $addressdirectory -type f -iname "*$name*" -exec mplayer {} \;
		    else
		        echo -e "${RD}Your type is not true!"
		    fi
		else
			echo -e "${RD}Invalid argument!"
		fi
	else
	    echo -e "${RD}Invalid argument!"
	fi
	echo -e "${GRE}done!"
}

# ----------\Uninstall function\----------
function uninstall(){
	clear

	GRE='\033[92m' # Green Light
	RD='\033[91m' # Red Light

	read -p "Are you sure to uninstall music-finder??!! [y/N] " delete

	# ----------\Uninstall music-finder\---------
	if [[ "$delete" == "y" || "$delete" == "Y" ]]; then
		del_dependes=0
		#Checking if the distro is debianbase / archbase / redhatbase/ openSUSEbase and running the correct command
		codename="lsb_release -c | awk {'print $2'}"
		architecture="dpkg --print-architecture"
		if pacman -Q &> /dev/null; then # Check Arch
			sudo pacman -Rs mplayer
		elif [[ "$codename" == "bionic" ]] && [[ "$architecture" == "armhf" ]]; then # Check Ubuntu Server and raspberry
			sudo apt remove mplayer
		elif apt list --installed &> /dev/null; then # Check Debian
			sudo apt remove mplayer
		elif dnf list &> /dev/null; then # Check Fedora
			sudo dnf remove mplayer
		elif zypper search i+ &> /dev/null; then # Check openSUSE
			sudo zypper remove mplayer
		else
			echo -e "${RD}Your distro is neither archbase nor debianbase nor redhatbase nor susebase So, The script is not going to work in your distro and you have uninstall the dependensies manually. for more information read README.md"
			del_dependes="1"
		fi

		sudo rm -f /usr/bin/music-finder
		# ----------\Removing Music-finder Command\----------
		if [[ "$del_dependes" == "0" ]]; then
		# bug : if user doesnt enter password script print music-finder succesfully uninstalled
		    echo -e "\n ${RD}music-finder succesfully uninstalled :( "
		else
			exit 1
		fi
	elif [[ "$delete" == "" || "$delete" == "n" || "$delete" == "N" ]]; then
		echo -e "\n ${GRE}music-finder is still installed :) "
		exit 0
	else
		echo -e "${RD}Invalid argument!"
		exit 1
	fi
}

# ----------\Update fiunction\----------
function update(){
	cd /tmp
	git clone https://gitlab.com/Music_Finder/music-finder.git
	sleep 2
	cd music-finder
	sudo cp music-finder /usr/bin/music-finder
	sudo chmod 755 /usr/bin/music-finder
	echo -e " ${GRE}Music_Finder updated succesfully! "
}

# --------\Input options\--------
case "$1" in
    "")    main    ;;
    "--update" | "-U")    update    ;;
	"--uninstall")    uninstall    ;;
esac
exit 0
